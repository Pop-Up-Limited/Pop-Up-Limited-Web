---
import { FORM_ENDPOINT, SUPPORT_EMAIL } from '../config/site';
import { products } from '../data/products';

const hasEndpoint = Boolean(FORM_ENDPOINT);
const action = hasEndpoint ? FORM_ENDPOINT : undefined;
---

<section class="card-surface">
  <div class="mb-6 space-y-2">
    <h2 class="text-xl font-semibold text-foreground dark:text-foreground-dark">
      Submit a support ticket
    </h2>
    <p class="text-sm text-foreground-muted dark:text-slate-300">
      Share as much context as possible so we can expedite your request. {/* TODO: refine instructions */}
    </p>
  </div>

  <form
    id="support-ticket-form"
    class="grid gap-5"
    method="POST"
    action={action}
    data-has-endpoint={hasEndpoint.toString()}
  >
    {/* TODO: replace FORM_ENDPOINT in site config with your Formspree endpoint */}
    <div class="grid gap-2">
      <label class="text-sm font-medium text-foreground dark:text-foreground-dark" for="support-name">
        Name
      </label>
      <input
        class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm transition focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-200 dark:border-slate-700 dark:bg-slate-900/80"
        type="text"
        id="support-name"
        name="name"
        placeholder="Your name"
        required
      />
    </div>

    <div class="grid gap-2">
      <label class="text-sm font-medium text-foreground dark:text-foreground-dark" for="support-email">
        Email
      </label>
      <input
        class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm transition focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-200 dark:border-slate-700 dark:bg-slate-900/80"
        type="email"
        id="support-email"
        name="email"
        placeholder="you@company.com"
        required
      />
    </div>

    <div class="grid gap-2">
      <label class="text-sm font-medium text-foreground dark:text-foreground-dark" for="support-product">
        Product
      </label>
      <select
        class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm transition focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-200 dark:border-slate-700 dark:bg-slate-900/80"
        id="support-product"
        name="product"
        required
      >
        <option value="" disabled selected>Select a product</option>
        {products.map((product) => (
          <option value={product.name}>{product.name}</option>
        ))}
        <option value="Other">Other</option>
      </select>
    </div>

    <div class="grid gap-2">
      <label class="text-sm font-medium text-foreground dark:text-foreground-dark" for="support-message">
        Describe your issue
      </label>
      <textarea
        class="min-h-[160px] rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm transition focus:border-brand-400 focus:outline-none focus:ring-2 focus:ring-brand-200 dark:border-slate-700 dark:bg-slate-900/80"
        id="support-message"
        name="message"
        placeholder="Let us know what happened, the priority, and how to reach you."
        required
      />
    </div>

    <div class="flex flex-col gap-3">
      <button type="submit" class="btn-primary">
        Send request
      </button>
      {!hasEndpoint && (
        <p class="text-xs text-foreground-muted dark:text-slate-400">
          This form currently shows a placeholder confirmation only. To enable live submissions, configure your Formspree endpoint in <code>src/config/site.ts</code> and update your support workflow. {/* TODO */}
        </p>
      )}
    </div>

    <p
      id="ticket-form-status"
      class="hidden rounded-xl bg-brand-500/10 px-4 py-3 text-sm text-brand-700"
      role="status"
      aria-live="polite"
    ></p>
  </form>
</section>

<script type="module">
  const form = document.querySelector('#support-ticket-form');
  const status = document.querySelector('#ticket-form-status');

  if (form instanceof HTMLFormElement && status instanceof HTMLElement) {
    form.addEventListener('submit', (event) => {
      const hasEndpoint = form.dataset.hasEndpoint === 'true';
      if (!form.checkValidity()) {
        event.preventDefault();
        form.reportValidity();
        return;
      }

      if (!hasEndpoint) {
        event.preventDefault();

        status.textContent = `Thanks! We’ve noted your request and will reply from ${SUPPORT_EMAIL} within one business day. (Placeholder message — update once Formspree is connected.)`;
        status.classList.remove('hidden');
      }
    });
  }
</script>

